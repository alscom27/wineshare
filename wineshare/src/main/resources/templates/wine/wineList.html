<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<!-- 사용자 css -->
<th:block layout:fragment="css">
    <link rel="stylesheet" type="text/css" th:href="@{/wineshare-css/wine-list.css}">

</th:block>

<!--/* 사용자 스크립트 추가 */-->
<th:block layout:fragment="script">
    <script th:inline="javascript">

        $(document).ready(function() {


            $('#sortBy').change(function (){
                page(0);
            });

            $('#searchWineType').change(function () {
               page(0);
            });


        });
        // 요거랑 컨트롤러쪽에서만 ajax로 바꾸면.. 될거같은데!ㅉ@!!!@@ㅃㅃㅉ#ㅆㅎㅁㅆㅃ
        // 페이지네이션 클릭 시 페이지 이동
        function page(page) {
            // th:field 는 value, name, id 를 모두 대체함 id(#)으로 호출 가능
            const searchWineType = $('#searchWineType').val();
            const sortBy = $('#sortBy').val();
            // 슬라이더에서 설정된 가격범위
            const minPrice = $("#slide-range").slider("values", 0); // 슬라이더의 최소값
            const maxPrice = $("#slide-range").slider("values", 1); // 슬라이더의 최대값

            location.href = "/wines/list/" + page
                + "?minPrice=" + minPrice
                + "&maxPrice=" + maxPrice
                + "&searchWineType=" + searchWineType
                + "&sortBy=" + sortBy;
        }



    </script>
</th:block>

<div layout:fragment="content" >
    <form th:action="@{'/wines/list/' + ${wines.number}}" role="form" method="get" th:object="${wines}">

        <!-- 각 페이지 상단에 경로 나타내주는 부분.. -->
        <div class="page-title parallax parallax1">
            <div class="container">
                <div class="page-title-content d-sm-flex justify-content-sm-between align-items-center text-center">
                    <div class="breadcrumbs">
                        <ul>
                            <li><a href="#">Home</a></li>
                            <li><a href="#">Product</a></li>
                            <li class="blog"><a href="#">Shop Full Width</a></li>
                        </ul>
                    </div>
                    <div class="page-title-heading">
                        <h2 class="title"><a href="#">ARCHIVES PRODUCTS</a></h2>
                    </div>
                </div>
            </div>
        </div> <!-- /.page-title -->


        <div th:object="${wineSearchDTO}">
            <!-- 필터 레인지 바 -->
            <div class="sidebar-inner clearfix">
                <div class="widget widget-filter">
                    <div class="type-filter">
                        <h5>Type</h5>
                        <select th:field="*{searchWineType}" >
                            <option value="">ALL</option>
                            <option value="RED">RED</option>
                            <option value="WHITE">WHITE</option>
                            <option value="SPARKLING">SPARKLING</option>
                            <option value="ROSE">ROSE</option>
                            <option value="DESSERT">DESSERT</option>
                            <option value="PORT">PORT</option>
                        </select>
                    </div>
                    <div class="text-title">
                        <h2 class="widget-title text-center">Price Range</h2>
                    </div>
                    <div class="price-filter clearfix">
                        <div id="slide-range"></div>
<!--                        <span class="filter"><a class="hvr-shutter-out-horizontal" th:onclick=" 'javascript:page(0)'" >FILTER</a></span>-->
                        <p class="amount">
                            Price: <span id="amount"></span>
                        </p>
                    </div>

                    <!-- 정렬용 셀렉트바 -->
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="filter-shop">
                                <div class="sort-filter">
                                    <h5>Sort by</h5>
                                    <select th:field="*{sortBy}" style="width:auto;">
                                        <option value="">최신 등록 순</option>
                                        <option value="priceDesc">가격 높은 순</option>
                                        <option value="priceAsc">가격 낮은 순</option>
                                        <option value="ratingDesc">평점 높은 순</option>
                                        <option value="ratingAsc">평점 낮은 순</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>



        <div class="main-shop-fullwidth-grid">
            <div class="container">

                <section class="flat-products style3">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="product-content product-fourcolumn clearfix">

                                    <ul class="product style2 isotope-product clearfix" id="wineListContainer">
                                        <li class="product-item features arrivals" th:each="wine, status : ${wines.getContent()}">
                                            <div class="product-thumb clearfix">
                                                <a th:href="@{'/wines/wine/' + ${wine.id}}" class="product-thumb">
                                                    <img th:src="${wine.wineImg == 'https://images.vivino.com/highlights/icon/most_user_rated.svg' || wine.wineImg == 'https://thumbs.vivino.com/avatars/ZlapMkM9QayY3ci79lSL7A_50x50.jpg' ? '/image/wineDefault.png' : wine.wineImg}" alt="image"
                                                         th:class="wine_image"
                                                         onerror="this.onerror=null; this.src='/image/wineDefault.png'; this.className='wine_image'">
                                                </a>
                                            </div>
                                            <div class="product-info text-center clearfix">
                                                <div class="price">
                                                    <ins>
                                                        <span class="amount" th:text="${wine.price == null || wine.price == 0 ? '가격정보없음' : wine.price + ' ₩'}">와인 가격</span>
                                                    </ins>
                                                </div>
                                                <span class="product-title" th:text="${wine.wineName}">와인 이름</span>
                                            </div>
                                            <div class="product-review">
                                                <div class="add-cart">
                                                    <a href="#" class="like2"><i class="fa fa-heart-o"></i></a>
                                                </div>
                                            </div>
                                        </li> <!-- /product-item -->
                                    </ul>

                                </div>
                            </div> <!-- /col-lg-12 -->
                            <!-- 페이지네이션 -->
                            <div class="blog-pagination text-center"
                                 th:with="start=${(wines.number / maxPage) * maxPage + 1},
                                        end=${(wines.totalPages == 0) ?
                                        1 : (start + (maxPage - 1) < wines.totalPages ?
                                        start + (maxPage - 1) : wines.totalPages)}">
                                <ul class="flat-pagination">
                                    <li class="prev hvr-shutter-out-horizontal" th:classappend="${wines.first} ? 'disabled'">
                                        <a th:onclick="'javascript:page(' + ${wines.number -1} + ')'" aria-label="Previous" >
                                            <i class="fa fa-angle-left" aria-hidden="true"></i>
                                        </a>
                                    </li>
                                    <li class="hvr-shutter-out-horizontal" th:each="page: ${#numbers.sequence(start, end)}">
                                        <a th:onclick=" 'javascript:page(' + ${page - 1} + ')'" th:inline="text" >
                                            [[${page}]]
                                        </a>
                                    </li>
                                    <li class="next hvr-shutter-out-horizontal" th:classappend="${wines.last} ? 'disabled'">
                                        <a th:onclick="'javascript:page(' + ${wines.number + 1} + ')'" aria-label="Next" >
                                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                                        </a>
                                    </li>
                                </ul>
                            </div>


                        </div> <!-- /row -->
                    </div> <!-- /container-->
                </section>
            </div> <!-- / main-shop-fullwidth-grid -->
        </div>
    </form>
</div>
</html>
